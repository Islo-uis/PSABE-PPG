<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teno in Nach â€” Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.datatables.net/2.3.3/css/dataTables.dataTables.css" />

  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
    }

    .d-flex {
      display: flex;
      height: 100%;
    }

    #sidebar {
      width: 250px;
      background: #343a40;
      color: #fff;
      display: flex;
      flex-direction: column;
      padding: 1rem;
    }

    #sidebar h4 {
      margin-bottom: 2rem;
      text-align: center;
      font-weight: bold;
    }

    #sidebar .nav-link {
      color: #ced4da;
      margin-bottom: .5rem;
      padding: .5rem 1rem;
      border-radius: .25rem;
      transition: background .2s;
    }

    #sidebar .nav-link.active,
    #sidebar .nav-link:hover {
      background: #495057;
      color: #fff;
    }

    #sidebar .btn-logout {
      margin-top: auto;
      background: #ff416c;
      border: none;
      color: #fff;
      padding: .5rem;
      border-radius: .25rem;
    }

    #sidebar .btn-logout:hover {
      background: #ff4b2b;
    }

    .card-draggable {
      cursor: move;
    }

    .card-draggable img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .card-actions {
      position: absolute;
      top: .5rem;
      right: .5rem;
    }

    .card-disabled {
      opacity: .5;
    }

    .add-tile {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: #aaa;
      cursor: pointer;
      height: 100%;
      min-height: 200px;
      border: 2px dashed #ddd;
      border-radius: .5rem;
      transition: background .2s;
    }

    .add-tile:hover {
      background: #e9ecef;
    }

    .stock-input {
      width: 60px;
    }
  </style>
</head>

<body>

  <div class="d-flex">
    <nav id="sidebar">
      <h4>Teno in Nach</h4>
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link active" href="admin.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="users.php">Users</a></li>
        <li class="nav-item"><a class="nav-link" href="transactions.php">Transactions</a></li>
        <li class="nav-item"><a class="nav-link" href="tabulation.html">Tabulation</a></li>
      </ul>
      <button class="btn btn-logout">Logout</button>
    </nav>

    <div style="width: 100%; padding: 2%;">
      <div style="display: flex; justify-content: space-between;">
        <select class="form-select w-25" id="tableType">
          <option value="announcement" selected>Announcement</option>
          <option value="schedule">Schedule</option>
          <option value="events">Events</option>
          <option value="merch">Merch</option>
          <option value="highlights">Highlights</option>
        </select>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#aa-modal">Add</button>
      </div>

      <table id="myTable" class="display">
        <thead>
          <tr>
            <th>Order</th>
            <th>ID</th>
            <th>Header</th>
            <th>Description</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
    </div>
  </div>





  <!-- Add Row Modal -->
  <div class="modal fade" id="aa-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title">
            <span class="fw-mediumbold"> Add Announcement </span>
          </h5>
          <button type="button" class="close" id="aa-exit" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="aa-form" enctype="multipart/form-data">
            <div class="row">
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Header</label>
                  <input id="aa-header" name="aa-header" type="text" class="form-control"
                    placeholder="Enter Header Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Description</label>
                  <input id="aa-desc" name="aa-desc" type="text" class="form-control"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Photo</label>
                  <input id="aa-photo" name="aa-photo" type="file" class="form-control" accept="image/*"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <img id="aa-card-preview" class="rounded mb-2" style="height:35vh;object-fit:cover;" alt="Preview">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-0">
          <button type="button" id="addRowButton" class="btn btn-primary" onclick="addAnnouncement()">
            Add
          </button>
          <button type="button" id="aa-close" class="btn btn-danger">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Row Modal -->
  <div class="modal fade" id="ea-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title">
            <span class="fw-mediumbold"> Edit Announcement </span>
          </h5>
          <button type="button" class="close" id="ea-exit" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="ea-form" enctype="multipart/form-data">
            <input type="hidden" name="ea-id" id="ea-id">
            <div class="row">
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Header</label>
                  <input id="ea-header" name="ea-header" type="text" class="form-control"
                    placeholder="Enter Header Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Description</label>
                  <input id="ea-desc" name="ea-desc" type="text" class="form-control"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Photo</label>
                  <input id="ea-photo" name="ea-photo" type="file" class="form-control" accept="image/*"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <img id="ea-card-preview" class="rounded mb-2" style="height:35vh;object-fit:cover;" alt="Preview">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-0">
          <button type="button" id="addRowButton" class="btn btn-primary" onclick="editAnnouncement()">
            Add
          </button>
          <button type="button" id="ea-close" class="btn btn-danger">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- Bootstrap + Logic -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/2.3.3/js/dataTables.js"></script>
  <script src="assets/announcement.js"></script>
  <script>

    const headersMap = {
      announcement: ["Order", "ID", "Header", "Description", "Action"],
      schedule: ["ID", "Title", "Date & Time", "Action"],
      events: ["ID", "Event Name", "Location", "Date", "Action"],
      merch: ["ID", "Item", "Price", "Stock", "Action"],
      highlights: ["ID", "Highlight", "Category", "Views", "Action"]
    };
    var table = $("#myTable").DataTable();

    $("#tableType").on("change", function () {
      let type = $(this).val();
      let headers = headersMap[type];

      // Destroy DataTable before changing headers
      table.destroy();

      // Rebuild table head
      let thead = $("#myTable thead tr");
      thead.empty();
      headers.forEach(h => {
        thead.append(`<th>${h}</th>`);
      });

      // Clear tbody as well (optional, depends on your data loading strategy)
      $("#myTable tbody").empty();

      // Reinitialize DataTable
      table = $("#myTable").DataTable({
        // if you want, define columns explicitly to match headers
        columns: headers.map(h => ({ title: h }))
      });


      loadData()
    });


    document.addEventListener('DOMContentLoaded', function () {
      loadData()
      // render("announcement")
    });

    function loadData() {
      var category = document.getElementById("tableType").value;
      let ajax = "";
      if (category == "announcement") {
        ajax = "assets/ajax.php?action=getAnnouncements";
      }
      $.ajax({
        url: ajax,
        type: "POST",
        dataType: 'json',
        success: function (response) {
          var data = response.announcements;
          console.log(data)
          table.clear().draw();
          $.each(data, function (index, value) {
            if (value.status == 0) {
              table.row.add([
                value.order,
                value.id,
                value.header,
                value.desc,
                `<button type="button" class="btn btn-success" data-bs-toggle="modal" onclick="viewAnnouncementData(${value.id})" data-bs-target="#ea-modal">Edit </button>
              <button type="button" class="btn btn-primary" onclick="changeAnnouncementOrder(${value.id}, 'up')">Up </button>
              <button type="button" class="btn btn-warning" onclick="changeAnnouncementOrder(${value.id}, 'down')">Down </button>
              <button type="button" class="btn btn-success" onclick="changeAnnouncementStatus(${value.id}, 1)">Enable </button>`

              ]).draw(false);
            }
            else {
              table.row.add([
                value.order,
                value.id,
                value.header,
                value.desc,
                `<button type="button" class="btn btn-success" data-bs-toggle="modal" onclick="viewAnnouncementData(${value.id})" data-bs-target="#ea-modal">Edit </button>
              <button type="button" class="btn btn-primary" onclick="changeAnnouncementOrder(${value.id}, 'up')">Up </button>
              <button type="button" class="btn btn-warning" onclick="changeAnnouncementOrder(${value.id}, 'down')">Down </button>
              <button type="button" class="btn btn-danger" onclick="changeAnnouncementStatus(${value.id}, 0)">Disable </button>`

              ]).draw(false);
            }


          });
        },
        error: function (xhr, status, error) {
          console.error("AJAX error: " + status + " - " + error);
        }
      });

    }


  </script>

</body>

</html>