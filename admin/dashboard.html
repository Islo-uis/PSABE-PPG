<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teno in Nach â€” Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.datatables.net/2.3.3/css/dataTables.dataTables.css" />

  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
    }

    .d-flex {
      display: flex;
      height: 100%;
    }

    #sidebar {
      width: 250px;
      background: #343a40;
      color: #fff;
      display: flex;
      flex-direction: column;
      padding: 1rem;
    }

    #sidebar h4 {
      margin-bottom: 2rem;
      text-align: center;
      font-weight: bold;
    }

    #sidebar .nav-link {
      color: #ced4da;
      margin-bottom: .5rem;
      padding: .5rem 1rem;
      border-radius: .25rem;
      transition: background .2s;
    }

    #sidebar .nav-link.active,
    #sidebar .nav-link:hover {
      background: #495057;
      color: #fff;
    }

    #sidebar .btn-logout {
      margin-top: auto;
      background: #ff416c;
      border: none;
      color: #fff;
      padding: .5rem;
      border-radius: .25rem;
    }

    #sidebar .btn-logout:hover {
      background: #ff4b2b;
    }

    .card-draggable {
      cursor: move;
    }

    .card-draggable img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .card-actions {
      position: absolute;
      top: .5rem;
      right: .5rem;
    }

    .card-disabled {
      opacity: .5;
    }

    .add-tile {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: #aaa;
      cursor: pointer;
      height: 100%;
      min-height: 200px;
      border: 2px dashed #ddd;
      border-radius: .5rem;
      transition: background .2s;
    }

    .add-tile:hover {
      background: #e9ecef;
    }

    .stock-input {
      width: 60px;
    }
  </style>
</head>

<body>

  <div class="d-flex">
    <nav id="sidebar">
      <h4>Teno in Nach</h4>
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link active" href="admin.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="users.html">Users</a></li>
        <li class="nav-item"><a class="nav-link" href="transactions.php">Transactions</a></li>
        <li class="nav-item"><a class="nav-link" href="tabulation.html">Tabulation</a></li>
      </ul>
      <button class="btn btn-logout">Logout</button>
    </nav>
    <div style="width: 100%;padding: 2%;">
      <div style="display: flex; justify-content: space-between;">
        <select class="form-select w-25" id="tableType">
          <option value="announcement" selected>Announcement</option>
          <option value="events">Events</option>
          <option value="merch">Merch</option>
          <option value="highlights">Highlights</option>
        </select>
        <button type="button" class="btn btn-primary" id="addButton">Add</button>
      </div>

      <table id="myTable" class="display">
        <thead>
          <tr>
            <th>Order</th>
            <th>ID</th>
            <th>Header</th>
            <th>Description</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
      <div class="card">
        <p class="p-3 fs-3">Schedule</p>
        <div class="card-body d-flex justify-content-center">
          <img id="sched-photo" class="img-fluid w-25" alt="...">
        </div>
        <div class="card-body d-flex justify-content-center">
          <form id="sched-form" enctype="multipart/form-data">
            <input type="file" id="sched-file" name="sched-file" accept="image/*" hidden onchange="changeSched()">
            <button type="button" class="btn btn-primary" onclick="document.getElementById('sched-file').click()">Change
              Schedule Photo</button>
          </form>

        </div>
      </div>
    </div>
  </div>

  <!-- Add Row Modal -->
  <div class="modal fade" id="aa-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title">
            <span class="fw-mediumbold"> Add Announcement </span>
          </h5>
          <button type="button" class="close" id="aa-exit" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="aa-form" enctype="multipart/form-data">
            <div class="row">
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Header</label>
                  <input id="aa-header" name="aa-header" type="text" class="form-control"
                    placeholder="Enter Header Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Description</label>
                  <input id="aa-desc" name="aa-desc" type="text" class="form-control"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Photo</label>
                  <input id="aa-photo" name="aa-photo" type="file" class="form-control" accept="image/*"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <img id="aa-card-preview" class="rounded mb-2" style="height:35vh;object-fit:cover;" alt="Preview">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-0">
          <button type="button" id="addRowButton" class="btn btn-primary" onclick="addAnnouncement()">
            Add
          </button>
          <button type="button" id="aa-close" class="btn btn-danger">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Row Modal -->
  <div class="modal fade" id="ea-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title">
            <span class="fw-mediumbold"> Edit Announcement </span>
          </h5>
          <button type="button" class="close" id="ea-exit" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="ea-form" enctype="multipart/form-data">
            <input type="hidden" name="ea-id" id="ea-id">
            <div class="row">
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Header</label>
                  <input id="ea-header" name="ea-header" type="text" class="form-control"
                    placeholder="Enter Header Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Description</label>
                  <input id="ea-desc" name="ea-desc" type="text" class="form-control"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Photo</label>
                  <input id="ea-photo" name="ea-photo" type="file" class="form-control" accept="image/*"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <img id="ea-card-preview" class="rounded mb-2" style="height:35vh;object-fit:cover;" alt="Preview">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-0">
          <button type="button" id="addRowButton" class="btn btn-primary" onclick="editAnnouncement()">
            Edit
          </button>
          <button type="button" id="ea-close" class="btn btn-danger">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="am-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title">
            <span class="fw-mediumbold"> Add Merch </span>
          </h5>
          <button type="button" class="close" id="am-exit" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="am-form" enctype="multipart/form-data">
            <div class="row">
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Name</label>
                  <input id="am-name" name="am-name" type="text" class="form-control" placeholder="Enter Name Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Price</label>
                  <input id="am-price" name="am-price" type="number" class="form-control"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="sizeornot" value="with" id="yessize" checked>
                    <label class="form-check-label" for="yessize">
                      With Sizes
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="sizeornot" value="without" id="nosize">
                    <label class="form-check-label" for="nosize">
                      Without Sizes
                    </label>
                  </div>
                </div>
              </div>
              <div class="col-sm-12 mb-3" style="display: none;" id="nsize">
                <div class="form-group form-group-default">
                  <label>QTY</label>
                  <input id="am-qty" name="am-qty" type="number" class="form-control" placeholder="Enter QTY" />
                </div>
              </div>
              <div class="row" id="size">
                <div class="col-md-4">
                  <div class="form-group form-group-default">
                    <label>Small</label>
                    <input id="am-sqty" name="am-sqty" type="number" class="form-control" placeholder="QTY" min="1" />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group form-group-default">
                    <label>Medium</label>
                    <input id="am-mqty" name="am-mqty" type="number" class="form-control" placeholder="QTY" min="1" />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group form-group-default">
                    <label>Large</label>
                    <input id="am-lqty" name="am-lqty" type="number" class="form-control" placeholder="QTY" min="1" />
                  </div>
                </div>
              </div>

              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Photo</label>
                  <input id="am-photo" name="am-photo" type="file" class="form-control" accept="image/*"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <img id="am-card-preview" class="rounded mb-2" style="height:35vh;object-fit:cover;" alt="Preview">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-0">
          <button type="button" id="addRowButton" class="btn btn-primary" onclick="addMerch()">
            Add
          </button>
          <button type="button" id="am-close" class="btn btn-danger">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="em-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title">
            <span class="fw-mediumbold"> Edit Merch </span>
          </h5>
          <button type="button" class="close" id="em-exit" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="em-form" enctype="multipart/form-data">
            <input type="hidden" name="em-id" id="em-id">
            <input type="hidden" name="em-hasSize" id="em-hasSize">
            <div class="row">
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Name</label>
                  <input id="em-name" name="em-name" type="text" class="form-control" placeholder="Enter Name Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Price</label>
                  <input id="em-price" name="em-price" type="number" class="form-control"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="em-sizeornot" value="with" id="em-yessize" checked>
                    <label class="form-check-label" for="em-yessize">
                      With Sizes
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="em-sizeornot" value="without" id="em-nosize">
                    <label class="form-check-label" for="em-nosize">
                      Without Sizes
                    </label>
                  </div>
                </div>
              </div>
              <div class="col-sm-12 mb-3" style="display: none;" id="em-nsize">
                <div class="form-group form-group-default">
                  <label>QTY</label>
                  <input id="em-qty" name="em-qty" type="number" class="form-control" placeholder="Enter QTY" />
                </div>
              </div>
              <div class="row" id="em-size">
                <div class="col-md-4">
                  <div class="form-group form-group-default">
                    <label>Small</label>
                    <input id="em-sqty" name="em-sqty" type="number" class="form-control" placeholder="QTY" min="1" />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group form-group-default">
                    <label>Medium</label>
                    <input id="em-mqty" name="em-mqty" type="number" class="form-control" placeholder="QTY" min="1" />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group form-group-default">
                    <label>Large</label>
                    <input id="em-lqty" name="em-lqty" type="number" class="form-control" placeholder="QTY" min="1" />
                  </div>
                </div>
              </div>

              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <label>Photo</label>
                  <input id="em-photo" name="em-photo" type="file" class="form-control" accept="image/*"
                    placeholder="Enter Description Here" />
                </div>
              </div>
              <div class="col-sm-12 mb-3">
                <div class="form-group form-group-default">
                  <img id="em-card-preview" class="rounded mb-2" style="height:35vh;object-fit:cover;" alt="Preview">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-0">
          <button type="button" id="addRowButton" class="btn btn-primary" onclick="editMerch()">
            Edit
          </button>
          <button type="button" id="em-close" class="btn btn-danger">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- Bootstrap + Logic -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/2.3.3/js/dataTables.js"></script>
  <script src="assets/announcement.js"></script>
  <script src="assets/merch.js"></script>
  <script>

    const headersMap = {
      announcement: ["Order", "ID", "Header", "Description", "Action"],
      events: ["ID", "Event Name", "Location", "Date", "Action"],
      merch: ["ID", "Item", "Price", "Stocks", "Stock (Small)", "Stock (Medium)", "Stock (Large)", "Action"],
      highlights: ["ID", "Highlight", "Category", "Views", "Action"]
    };
    var table = $("#myTable").DataTable();

    $("#tableType").on("change", function () {
      let type = $(this).val();
      let headers = headersMap[type];

      // Destroy DataTable before changing headers
      table.destroy();

      // Rebuild table head
      let thead = $("#myTable thead tr");
      thead.empty();
      headers.forEach(h => {
        thead.append(`<th>${h}</th>`);
      });

      // Clear tbody as well (optional, depends on your data loading strategy)
      $("#myTable tbody").empty();

      // Reinitialize DataTable
      table = $("#myTable").DataTable({
        // if you want, define columns explicitly to match headers
        columns: headers.map(h => ({ title: h }))
      });


      loadData()
    });


    document.addEventListener('DOMContentLoaded', function () {
      loadData()
      // render("announcement")
      loadSched();
    });


    function loadSched() {
      $.ajax({
        url: "assets/ajax.php?action=getSched",
        type: "POST",
        dataType: 'json',
        success: function (response) {
          document.getElementById("sched-photo").src = "../photos/schedule/" + response.photo;
        },
        error: function (xhr, status, error) {
          console.error("AJAX error: " + status + " - " + error);
        }
      });
    }

    function changeSched() {
      const form = document.getElementById("sched-form");
      const formData = new FormData(form);

      $.ajax({
        url: "assets/ajax.php?action=changeSched",
        type: "POST",
        dataType: 'json',
        processData: false, // Required for FormData
        contentType: false,
        data: formData,
        success: function (response) {
          loadSched()
        },
        error: function (xhr, status, error) {
          console.error("AJAX error: " + status + " - " + error);
          console.log("Response text: " + xhr.responseText);
        }
      });
    }

    document.getElementById('addButton').addEventListener('click', () => {
      var category = document.getElementById("tableType").value;
      let modall = "";
      if (category == "announcement") {
        modall = "aa-modal";
      }
      else if (category == "merch") {
        modall = "am-modal";
      }
      const modalEl = document.getElementById(modall);
      const modal = new bootstrap.Modal(modalEl);
      modal.show();
    });

    function loadData() {
      var category = document.getElementById("tableType").value;
      let ajax = "";
      if (category == "announcement") {
        ajax = "assets/ajax.php?action=getAnnouncements";
      }
      else if (category == "merch") {
        ajax = "assets/ajax.php?action=getMerch";
      }
      $.ajax({
        url: ajax,
        type: "POST",
        dataType: 'json',
        success: function (response) {
          if (category == "announcement") {
            var data = response.announcements;
            // console.log(data)
            table.clear().draw();
            $.each(data, function (index, value) {
              if (value.status == 0) {
                table.row.add([
                  value.order,
                  value.id,
                  value.header,
                  value.desc,
                  `<button type="button" class="btn btn-success" data-bs-toggle="modal" onclick="viewAnnouncementData(${value.id})" data-bs-target="#ea-modal">Edit </button>
              <button type="button" class="btn btn-primary" onclick="changeAnnouncementOrder(${value.id}, 'up')">Up </button>
              <button type="button" class="btn btn-warning" onclick="changeAnnouncementOrder(${value.id}, 'down')">Down </button>
              <button type="button" class="btn btn-success" onclick="changeAnnouncementStatus(${value.id}, 1)">Enable </button>`

                ]).draw(false);
              }
              else {
                table.row.add([
                  value.order,
                  value.id,
                  value.header,
                  value.desc,
                  `<button type="button" class="btn btn-success" data-bs-toggle="modal" onclick="viewAnnouncementData(${value.id})" data-bs-target="#ea-modal">Edit </button>
              <button type="button" class="btn btn-primary" onclick="changeAnnouncementOrder(${value.id}, 'up')">Up </button>
              <button type="button" class="btn btn-warning" onclick="changeAnnouncementOrder(${value.id}, 'down')">Down </button>
              <button type="button" class="btn btn-danger" onclick="changeAnnouncementStatus(${value.id}, 0)">Disable </button>`

                ]).draw(false);
              }


            });
          }
          else if (category == "merch") {
            var data = response.merch;
            // console.log(data)
            table.clear().draw();
            $.each(data, function (index, value) {
              const statusBtn = value.status === 0
                ? `<button type="button" class="btn btn-success" onclick="changeMerchStatus(${value.id}, 1)">Enable</button>`
                : `<button type="button" class="btn btn-danger" onclick="changeMerchStatus(${value.id}, 0)">Disable</button>`;
              const qty = value.hasSize === 0 ? value.qty : (parseFloat(value.qtyS) + parseFloat(value.qtyM) + parseFloat(value.qtyL))

              table.row.add([
                value.id,
                value.name,
                value.price,
                qty,
                value.qtyS,
                value.qtyM,
                value.qtyL,
                `
                  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#em-modal"
                    onclick="viewMerchData(${value.id})">
                    Edit
                  </button>
                  ${statusBtn}
                `
              ]).draw(false);



            });
          }

        },
        error: function (xhr, status, error) {
          console.error("AJAX error: " + status + " - " + error);
        }
      });

    }


  </script>

</body>

</html>