<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABECON2025 | Shop Merch</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-[url('/images/background.jpg')] bg-cover bg-no-repeat font-sans">

    <!-- Navbar -->
    <header class="fixed top-0 w-full z-49 bg-white border-b border-gray-200">
        <nav class="max-w-6xl mx-auto flex justify-between items-center p-4">
            <div class="actions" style="display: none;">
                <span id="hamburger-btn" class="material-symbols-outlined">menu</span>
            </div>
            <!-- Left: Logo -->
            <a href="#" class="flex items-center">
                <img src="merchlogo.png" alt="Logo" class="h-12">
            </a>

            <!-- Middle: Links -->
            <div class="hidden md:flex space-x-8 font-semibold text-lg">
                <a href="">Home</a>
                <a href="">About</a>
                <a href="">Events</a>
                <a href="">Schedule</a>
                <a href="" class="font-bold">Merch</a>
            </div>

            <!-- Right: Actions -->
            <div class="flex items-center space-x-4">
                <button id="openCart" class="relative">
                    <span class="material-symbols-outlined">shopping_cart</span>
                    <span id="cart-count"
                        class="absolute -top-2 -right-2 bg-black text-white text-xs px-2 rounded-full">0</span>
                </button>
                <a href="login.php"> <span class="material-symbols-outlined">account_circle</span></a>
            </div>
        </nav>
    </header>

    <main class="pt-20">
        <!-- Hero Banner -->
        <section class="relative">
            <img src="herobanner.jpg" alt="Merch Banner" class="w-full object-cover">
            <!-- <div class="absolute inset-0 bg-gradient-to-b from-transparent to-white"></div> -->
        </section>

        <!-- Cart Drawer -->
        <div id="overlay" class="fixed inset-0 bg-black/50 opacity-0 pointer-events-none transition duration-500 z-40">
        </div>

        <div id="cartDrawer"
            class="fixed top-0 right-0 w-96 h-full bg-white shadow-lg transform translate-x-full opacity-0 transition duration-500 z-50 flex flex-col">

            <!-- Header -->
            <div class="flex items-center gap-2 p-4 border-b">
                <button id="closeCart" class="text-gray-600">
                    <span class="material-symbols-outlined">arrow_back_ios</span>
                </button>
                <h2 class="font-semibold text-lg">Cart</h2>
            </div>

            <!-- Empty State -->
            <div id="empty-cart-display" class="flex-1 flex items-center justify-center text-gray-400 text-sm hidden">
                <p>You have no items in your cart.</p>
            </div>

            <!-- Cart Items -->
            <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-4">




            </div>
            <!-- Footer -->
            <div class="p-4 border-t">
                <div class="flex justify-between font-semibold mb-2">
                    <span>Total</span>
                    <span id="cart-total">â‚±0.00</span>
                </div>
                <button id="checkoutBtn"
                    class="w-full bg-green-700 hover:bg-green-800 text-white font-semibold py-2 rounded-lg">Checkout</button>
            </div>

        </div>


        <!-- Convention Kit Section -->
        <section class="max-w-6xl mx-auto py-12 text-center">
            <div class="mb-12">
                <h1 class="text-2xl font-bold">Convention Kit Inclusions</h1>
                <p class="">All items listed is free upon registration</p>
            </div>
            <div class="grid gap-6 grid-cols-1 mt-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
                <!-- Product Card -->
                <div
                    class="bg-white border rounded-xl p-4 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
                    <img src="/images/product-images/image 5.png" alt="White Shirt Small" class="rounded-md mb-3">
                    <h3 class="font-semibold text-base mb-1 text-left">White Shirt</h3>
                </div>
                <!-- Product Card -->
                <div
                    class="bg-white border rounded-xl p-4 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
                    <img src="/images/product-images/image 5.png" alt="White Shirt Small" class="rounded-md mb-3">
                    <h3 class="font-semibold text-base mb-1 text-left">Field Cap</h3>
                </div>

                <div
                    class="bg-white border rounded-xl p-4 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
                    <img src="/images/product-images/image 5.png" alt="White Shirt Small" class="rounded-md mb-3">
                    <h3 class="font-semibold text-base mb-1 text-left">Acrylic Button Pins</h3>
                </div>

                <div
                    class="bg-white border rounded-xl p-4 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
                    <img src="/images/product-images/image 5.png" alt="White Shirt Small" class="rounded-md mb-3">
                    <h3 class="font-semibold text-base mb-1 text-left">Canvas / Nylon Messenger Bag</h3>
                </div>

                <div
                    class="bg-white border rounded-xl p-4 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
                    <img src="/images/product-images/image 5.png" alt="White Shirt Small" class="rounded-md mb-3">
                    <h3 class="font-semibold text-base mb-1 text-left">Lanyard</h3>
                </div>

            </div>

        </section>

        <!-- Merch Section -->
        <section class="max-w-6xl mx-auto py-12 text-center">
            <h1 class="text-2xl font-bold mb-12">Shop Our Exclusive Merch</h1>

            <div id="product-cards" class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">

            </div>
        </section>
    </main>




    <!-- Modal Product -->
    <div id="product-modal" data-modal-backdrop="static" tabindex="-1" aria-hidden="true"
        class="hidden fixed inset-0 z-50 flex items-center justify-center w-full p-4 overflow-x-hidden overflow-y-auto">

        <div class="relative w-full max-w-4xl">
            <div class="relative bg-white rounded-xl shadow-lg p-6 md:p-10">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 overflow-hidden">

                    <!-- Left: Images -->
                    <div class="flex flex-col space-y-4 h-auto ">

                        <div class="relative overflow-hidden rounded-lg border shadow">
                            <img id="modal-img" src="" alt="Product Image" class="w-full object-cover aspect-[3/4]">
                        </div>

                        <div class="flex space-x-2 overflow-x-auto">
                            <div class=" overflow-hidden  rounded-lg">
                                <img id="modal-thumb1" src="" alt="Product Thumbnail"
                                    class="w-full object-cover border cursor-pointer aspect-[3/4]">
                            </div>
                            <div class=" overflow-hidden  rounded-lg">
                                <img id="modal-thumb2" src="" alt="Product Thumbnail"
                                    class="w-full  object-cover border cursor-pointer aspect-[3/4]">
                            </div>
                            <div class=" overflow-hidden  rounded-lg">
                                <img id="modal-thumb3" src="" alt="Product Thumbnail"
                                    class="w-full object-cover border cursor-pointer aspect-[3/4]">
                            </div>
                        </div>
                    </div>

                    <!-- <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">

        <div class="flex flex-row md:flex-col space-x-2 md:space-x-0 md:space-y-2 justify-center">
            <img id="modal-thumb-1" src="" alt="Product Thumbnail 1"
                class="w-20 h-24 md:w-32 md:h-40 object-cover rounded-lg border cursor-pointer aspect-[3/4]">
            <img id="modal-thumb-2" src="" alt="Product Thumbnail 2"
                class="w-20 h-24 md:w-32 md:h-40 object-cover rounded-lg border cursor-pointer aspect-[3/4]">
            <img id="modal-thumb-3" src="" alt="Product Thumbnail 3"
                class="w-20 h-24 md:w-32 md:h-40 object-cover rounded-lg border cursor-pointer aspect-[3/4]">
        </div>

        <div class="flex-grow">
            <img id="modal-img" src="" alt="Product Image"
                class="w-full rounded-lg border shadow object-cover aspect-[3/4] ">
        </div>
    </div> -->


                    <!-- Right: Details -->
                    <div class="flex flex-col  space-y-6">
                        <div>
                            <h2 id="modal-title" class="text-2xl font-bold mb-2"></h2>
                            <p id="modal-desc" class="text-gray-600 text-sm"></p>
                        </div>

                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span id="modal-price" class="text-2xl font-bold"></span>
                                <span id="modal-qty" class="text-gray-600 text-sm"></span>
                            </div>
                            <div class="flex items-center gap-4">
                                <!-- Quantity Selector -->
                                <div class="flex items-center border rounded-lg">
                                    <button id="qty-decrease"
                                        class="px-3 py-2 text-gray-600 hover:bg-gray-100">âˆ’</button>
                                    <span id="qty-value" class="px-4 py-2">1</span>
                                    <button id="qty-increase"
                                        class="px-3 py-2 text-gray-600 hover:bg-gray-100">+</button>
                                </div>

                                <!-- Add to Cart -->
                                <button id="add-to-cart" data-modal-hide="product-modal"
                                    class="flex-1 bg-black text-white font-semibold py-3 rounded-lg flex items-center justify-center gap-2 hover:bg-gray-800">
                                    <span class="material-symbols-outlined">shopping_cart</span>
                                    Add to cart
                                </button>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- Close -->
                <button type="button" data-modal-hide="product-modal"
                    class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast container -->
    <div id="toast-container" class="fixed bottom-5 left-1/2 -translate-x-1/2 z-50 space-y-2"></div>
    <script>
        function showToast(message) {
            const container = document.getElementById("toast-container");
            const toast = document.createElement("div");

            toast.className = "bg-white text-gray-800 font-medium text-sm px-6 py-3 rounded-lg shadow-lg transition-opacity duration-500 opacity-0";
            toast.innerText = message;

            container.appendChild(toast);

            // Fade in
            setTimeout(() => toast.classList.remove("opacity-0"), 50);

            // Fade out after 2s
            setTimeout(() => {
                toast.classList.add("opacity-0");
                setTimeout(() => toast.remove(), 500);
            }, 2000);
        }
    </script>

    <!-- for products table popuate -->
    <script>
        let selectedQty = 1;
        let maxQty = 0;
        let qtyValueSpan;

        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        document.addEventListener("DOMContentLoaded", function () {

            fetch("get_productsmerch.php")
                .then(res => res.json())
                .then(data => {

                    const parent = document.getElementById("product-cards");
                    parent.innerHTML = '';


                    if (data.length === 0) {
                        // If the data array is empty, display a "No products yet" message
                        parent.innerHTML = `
                                
                                <div class="col-span-4 text-center text-gray-500">
                                    <p>No products yet.</p>
                                </div>
                            `;
                    } else {

                        data.forEach(prod => {
                            const cardHTML = `
                                <div id="product-cart" data-modal-target="product-modal" data-id="${prod.prod_id}" data-modal-toggle="product-modal" data-title="${prod.prod_name}"
                                    data-price="â‚±${prod.prod_price.toFixed(2)}" data-qty="${prod.prod_qty}" data-img="admin/product-images/${prod.img1}"
                                    data-desc="${prod.prod_description}"
                                    class="bg-white border rounded-xl p-4 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">

                                    <img src="admin/product-images/${prod.img1}" class="rounded-md mb-3 object-cover aspect-[3/4]  w-auto">
                                    <h3 class="font-semibold text-base mb-1 text-left">${prod.prod_name}</h3>
                                    <div class="flex justify-between text-sm text-gray-600 mb-4">
                                        <span class="font-bold text-black">â‚±${prod.prod_price.toFixed(2)}</span>
                                        <span>Qty: ${prod.prod_qty}</span>
                                    </div>
                                    <button class="flex items-center justify-center gap-1 border px-3 py-2 rounded-md hover:bg-gray-100">
                                        <span class="material-symbols-outlined text-sm">add_shopping_cart</span>Add to cart
                                    </button>
                                </div>
                            `;
                            parent.innerHTML += cardHTML;

                        });
                        if (typeof Flowbite !== 'undefined') {
                            //initialize drawer
                            initFlowbite();
                        }

                        // --- The FIX: Add event listeners here after cards are created ---
                        const productCards = document.querySelectorAll('[data-modal-target="product-modal"]');


                        productCards.forEach(card => {
                            card.addEventListener('click', () => {

                                activeProductId = card.dataset.id;

                                document.getElementById('modal-title').innerText = card.dataset.title;
                                document.getElementById('modal-desc').innerText = card.dataset.desc;
                                document.getElementById('modal-price').innerText = card.dataset.price;
                                document.getElementById('modal-qty').innerText = "Qty: " + card.dataset.qty;
                                document.getElementById('modal-thumb1').src = card.dataset.img;
                                document.getElementById('modal-thumb2').src = card.dataset.img;
                                document.getElementById('modal-thumb3').src = card.dataset.img;
                                document.getElementById('modal-img').src = card.dataset.img;

                                // Important: Reset quantity and max value
                                maxQty = parseInt(card.dataset.qty, 10);
                                selectedQty = 1;


                                document.getElementById('qty-value').textContent = selectedQty;

                                // The `maxQty` variable was not used in your original logic, but it's important for later checks.
                                // You can now use `maxQty` to prevent the user from increasing the quantity beyond the available stock.
                                const qtyIncreaseBtn = document.getElementById('qty-increase');
                                const qtyDecreaseBtn = document.getElementById('qty-decrease');
                                qtyValueSpan = document.getElementById('qty-value');

                                qtyIncreaseBtn.onclick = () => {
                                    if (selectedQty < maxQty) {
                                        selectedQty++;
                                        qtyValueSpan.textContent = selectedQty;
                                    }
                                };
                                qtyDecreaseBtn.onclick = () => {
                                    if (selectedQty > 1) {
                                        selectedQty--;
                                        qtyValueSpan.textContent = selectedQty;
                                    }
                                };
                            });
                        });
                    }
                })
                .catch(err => console.error("Error loading products:", err));
        });


        const cartDrawer = document.getElementById("cartDrawer");
        const overlay = document.getElementById("overlay");
        const openCart = document.getElementById("openCart");
        const closeCart = document.getElementById("closeCart");

        openCart.addEventListener("click", () => {
            cartDrawer.classList.add("translate-x-0", "opacity-100");
            overlay.classList.add("opacity-100", "pointer-events-auto");
            document.body.classList.add("overflow-hidden");
        });

        function closeCartDrawer() {
            cartDrawer.classList.remove("translate-x-0", "opacity-100");
            overlay.classList.remove("opacity-100", "pointer-events-auto");
            document.body.classList.remove("overflow-hidden");
        }

        closeCart.addEventListener("click", closeCartDrawer);
        overlay.addEventListener("click", closeCartDrawer);
        // Update cart count on page load
        updateCartCount();

        document.getElementById("add-to-cart").addEventListener("click", () => {
            if (!activeProductId) {
                alert("No product selected.");
                return;
            }

            // --- UPDATED: Grab product ID from the active card
            const productId = activeProductId;
            // Grab modal product info
            const title = document.getElementById("modal-title").innerText;
            const price = document.getElementById("modal-price").innerText;
            const img = document.getElementById("modal-img").src;

            // Check if already in cart
            const existing = cart.find(item => item.id === productId);

            if (existing) {
                // prevent exceeding maxQty
                if (existing.qty + selectedQty > maxQty) {
                    alert(`You can only add up to ${maxQty} of this product.`);
                    return;
                }
                existing.qty += selectedQty;
            } else {
                if (selectedQty > maxQty) {
                    alert(`You can only add up to ${maxQty} of this product.`);
                    return;
                }
                cart.push({ id: productId, title, price, img, qty: selectedQty, maxQty });
            }

            // Save cart
            localStorage.setItem("cart", JSON.stringify(cart));

            // Update UI
            updateCartCount();
            renderCartItems();
            updateCartTotal();
            showToast(`Added ${selectedQty} x ${title} to cart`);
            openCart.click(); // Open cart drawer


            // Reset qty in modal
            selectedQty = 1;
            qtyValueSpan.textContent = 1;
        });

        function toggleCheckoutButton() {
            const checkoutBtn = document.getElementById("checkoutBtn");

            if (cart.length === 0) {
                checkoutBtn.disabled = true; // Disable the button
                checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                checkoutBtn.disabled = false; // Enable the button
                checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }


        function updateCartTotal() {
            const total = cart.reduce((sum, item) => {
                // remove "â‚±" and commas before converting to number
                const price = parseFloat(item.price.replace(/[â‚±,]/g, ""));
                return sum + (price * item.qty);
            }, 0);

            document.getElementById("cart-total").textContent = "â‚±" + total.toFixed(2);
            toggleCheckoutButton();
        }

        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.qty, 0);
            document.getElementById("cart-count").textContent = count;

        }



        function renderCartItems() {

            const emptyCartDisplay = document.getElementById("empty-cart-display");
            const cartContainer = document.querySelector("#cart-items");
            cartContainer.innerHTML = '';


            if (cart.length === 0) {
                emptyCartDisplay.classList.remove("hidden");   // show empty cart message
            } else {
                emptyCartDisplay.classList.add("hidden");
                cart.forEach((item, index) => {

                    const cartItemHTML = `
                <div class="flex items-center gap-3">
                    <img src="${item.img}" alt="${item.title}" class="w-14 aspect-[3/4] object-cover rounded border">
                    <div class="flex-1">
                        <p class="font-medium">${item.title}</p>
                        <p class="font-semibold text-sm">${item.price}</p>
                        <div class="flex items-center gap-2">
                            <button class="w-6 h-6 border rounded" onclick="changeQty(${index}, -1)">-</button>
                            <span>${item.qty}</span>
                            <button class="w-6 h-6 border rounded" onclick="changeQty(${index}, 1)">+</button>
                        </div>
                    </div>
                     <button class="text-gray-400 hover:text-gray-600" onclick="removeItem(${index})">Ã—</button>
                 </div>
                
        `;

                    cartContainer.innerHTML += cartItemHTML;
                });
            }
            updateCartTotal();

        }

        function changeQty(index, delta) {
            const item = cart[index];
            const newQty = item.qty + delta;

            if (newQty > item.maxQty) {
                alert(`You can only add up to ${item.maxQty} of this product.`);
                return;
            }

            if (newQty <= 0) {
                cart.splice(index, 1);
            } else {
                item.qty = newQty;
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
            updateCartTotal();

        }


        function removeItem(index) {
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
            updateCartTotal();

        }

        // Render cart initially
        renderCartItems();

        document.getElementById("checkoutBtn").addEventListener("click", () => {
            // Save the cart to localStorage (already done in your code)
            localStorage.setItem("cart", JSON.stringify(cart));

            // Redirect to checkout.html
            window.location.href = "checkout.html";
        });

    </script>

</body>

</html>