<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABECON2025 | Checkout</title>
    <link rel="icon" href="logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

</head>

<body class="h-screen bg-[url('/images/background.jpg')] bg-cover bg-no-repeat font-sans">

    <nav class="bg-white  fixed w-full z-20 top-0 start-0 border-b border-gray-200 dark:border-gray-600">
        <div class="max-w-screen-xl mx-auto p-4 flex justify-center items-center">
            <a href="#" class="flex items-center space-x-3">
                <img src="merchlogo.png" class="h-10" alt="Logo">

            </a>
        </div>
    </nav>


    <!-- Main Container -->
    <main
        class="w-full max-w-5xl mx-auto bg-white/90 shadow-lg rounded-lg p-6 md:p-8 mt-32 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="md:col-span-3 mb-4">
            <h2 class="text-xl font-bold">Order Details - Checkout Items</h2>
        </div>
        <!-- Left Column (Order Details) -->
        <section class=" order-2 md:order-1 space-y-6">

            <!-- Buyer Info -->
            <div class="space-y-3">
                <h3 class="font-semibold">Buyer Info</h3>

                <!-- Buyer Box -->
                <div class="border rounded-lg p-4 flex items-start gap-3">

                    <!-- Icon -->
                    <span class="material-symbols-outlined text-gray-600 text-2xl">person_pin_circle</span>

                    <!-- Text Content -->
                    <div class="flex flex-col">
                        <!-- Name + Phone inline -->
                        <div class="flex flex-wrap items-center gap-3">
                            <p class="font-semibold text-lg">Juan Dela Cruz</p>
                            <p class="text-gray-500">09123456789</p>
                        </div>

                        <!-- Email -->
                        <p class="text-sm text-gray-600">juan.delacruz@usep.edu.ph</p>
                    </div>

                </div>
            </div>


            <hr>

            <!-- Payment Method -->
            <div class="space-y-3">

                <button id="paymentMethodBtn" data-modal-target="payment-instruction-modal"
                    data-modal-toggle="payment-instruction-modal" class="flex items-center gap-2">
                    <h3 class="font-semibold">Payment Method</h3>
                    <span class="material-symbols-outlined text-gray-500 cursor-pointer text-sm">help</span>
                </button>

                <!-- Note + GCash logo row -->
                <div class="flex items-center justify-between">
                    <p class="text-sm text-gray-600">
                        Note: We only accept GCash payments as of the moment.
                    </p>
                    <img src="https://vectorseek.com/wp-content/uploads/2023/08/Gcash-Logo-Vector.svg-.png" alt="GCash"
                        class="h-6">
                </div>

            </div>

            <div class="flex justify-between items-center font-semibold text-lg">
                <span>Total</span>
                <span id="checkout-total" class="text-2xl">₱0.00</span>
            </div>
            <!-- Payment Button -->
            <button data-modal-target="payment-modal" data-modal-toggle="payment-modal"
                class="w-full bg-green-700 hover:bg-green-800 text-white font-semibold py-3 rounded-lg shadow">
                Continue to payment
            </button>
        </section>

        <!-- Right Column (Order Items) -->
        <aside id="checkout-items" class="order-1 space-y-4 md:order-2">
            <h3 class="font-semibold">Order Items</h3>

            

        </aside>
    </main>


    <!-- Static Modal -->
    <div id="payment-instruction-modal" data-modal-backdrop="static" tabindex="-1" aria-hidden="true"
        class="hidden fixed inset-0 z-50 flex items-center justify-center w-full p-4 overflow-x-hidden overflow-y-auto">
        <div class="relative w-full max-w-md">
            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow ">

                <!-- Modal body -->
                <div class="p-6 space-y-4 text-center">
                    <img src="https://vectorseek.com/wp-content/uploads/2023/08/Gcash-Logo-Vector.svg-.png" alt="GCash"
                        class="h-10 mx-auto">
                    <h2 class="text-lg font-semibold">Payment Instruction</h2>

                    <p class="text-sm text-gray-600">
                        We only accept <strong>GCash payments via QRPh or mobile number.</strong>
                    </p>

                    <ol class="text-left text-sm text-gray-700 space-y-2 list-decimal list-inside">
                        <li>Send your payment via <strong>GCash QR Ph</strong> or via <strong> Express Send.</strong>
                        </li>
                        <li>After paying, <strong>screenshot your receipt</strong> and copy the <strong>Reference Number
                                (Ref No.)</strong>.</li>
                        <li>In the next step, <strong>upload</strong> the screenshot as proof of payment.</li>
                        <li><strong>Paste the full Ref No.</strong> for order tracking.</li>
                    </ol>

                    <p class="text-sm font-semibold text-center">
                        <span>Important Reminder: </span> <br>
                        <span class="text-red-600">Missing or incorrect Ref No. = order forfeited.</span>
                    </p>
                </div>

                <!-- Modal footer -->
                <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-center">
                    <button data-modal-hide="payment-instruction-modal" type="button"
                        class="w-full bg-green-700 hover:bg-green-800 text-white font-semibold py-3 rounded-lg shadow">
                        I Understand
                    </button>
                </div>
            </div>
        </div>
    </div>



    <!-- Modal -->
    <div id="payment-modal" data-modal-backdrop="static" tabindex="-1" aria-hidden="true" aria-modal="true"
        role="dialog"
        class="hidden fixed inset-0 z-50 flex items-center justify-center w-full p-4 overflow-x-hidden overflow-y-auto">
        <div class="relative w-full max-w-md">

            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow">

                <!-- Modal header -->
                <div class="flex justify-center items-center p-4 border-b rounded-t">
                    <h3 class="text-lg font-semibold">Payment Receipt Upload Form</h3>
                </div>

                <!-- Modal body -->
                <div class="p-6 space-y-6 text-center">
                    <img src="https://vectorseek.com/wp-content/uploads/2023/08/Gcash-Logo-Vector.svg-.png" alt="GCash"
                        class="h-8 mx-auto">

                    <div class="text-center">
                        <p class="font-medium">Total amount</p>
                        <p id="payment-total" class="text-3xl font-bold mt-0">₱</p>
                    </div>

                    <!-- QR -->
                    <div class="border p-4 rounded-lg inline-block">
                        <img src="https://pnb-website.s3.ap-southeast-1.amazonaws.com/uploads/InstapayQR-logo.jpg"
                            alt="GCash QR" class="h-40 mx-auto">
                        <p class="mt-3 font-bold">ABECON2025</p>
                        <p class="text-sm">+63 912 345 6789</p>
                        <p class="text-xs text-gray-500">ABECON2025 (AB•••• M• G.)</p>
                    </div>
                </div>


                <form id="payment-form" class="p-6 space-y-6 text-center" action="" method="POST"
                    enctype="multipart/form-data">
                    <!-- Reference Number -->
                    <div class="text-left">
                        <label for="refno" class="block mb-1 text-sm font-medium">Paste GCash Reference Number (Ref
                            No.)</label>
                        <input required type="text" id="refno" name="refno" class="w-full border rounded-lg p-2 text-sm"
                            placeholder="Enter Ref No.">
                    </div>

                    <!-- Upload -->
                    <div class="text-left">
                        <label for="receipt-file" class="block mb-1 text-sm font-medium">Please upload screenshot of
                            your GCash payment receipt</label>
                        <div
                            class="relative border-2 border-dashed rounded-lg p-6 flex flex-col items-center justify-center text-gray-500">

                            <!-- Preview Image (hidden by default) -->
                            <img id="preview" class="hidden mb-2 w-full h-auto rounded-md" alt="Preview Image" />
                            <div id="photoinput" class="flex flex-col items-center justify-center">
                                <span class="material-symbols-outlined text-3xl">image</span>
                                <p class="text-xs mt-2">Click to upload</p>
                            </div>
                            <!-- File Input -->
                            <input required type="file" id="receipt-file" name="receipt-file"
                                class="absolute inset-0 opacity-0 cursor-pointer" accept="image/jpeg, image/png" />
                        </div>
                    </div>

                    <!-- Order DEtails -->

                    <input type="hidden" required name="buyer_id" id="buyer_id" value="">
                    <input type="hidden" required name="total_amount" id="order_total" value="">
                    <input type="hidden" required name="payment_refno" id="payment_refno" value="">
                    <input type="hidden" required name="payment_photo" id="payment_photo" value="">



                    <!-- Modal footer -->
                    <div class="py-4 border-t flex justify-center">
                        <button type="submit"
                            class="w-full bg-green-700 hover:bg-green-800 text-white font-semibold py-3 rounded-lg shadow">
                            Submit Payment Receipt
                        </button>
                    </div>
                </form>



            </div>
        </div>
    </div>


    <script>
        document.getElementById("receipt-file").addEventListener("change", function (event) {
            const file = event.target.files[0]; // Get the selected file
            const preview = document.getElementById("preview");
            const photoinput = document.getElementById("photoinput");

            // Check if a file is selected and it's an image
            if (file && (file.type === "image/jpeg" || file.type === "image/png")) {
                // Create a URL for the image and set it as the preview source
                const reader = new FileReader();

                reader.onload = function (e) {
                    preview.src = e.target.result; // Set image preview source
                    preview.classList.remove("hidden"); // Show the preview

                    photoinput.style.display = "none"; // Hide the upload prompt
                };

                reader.readAsDataURL(file); // Read the image as a data URL
            } else {
                preview.classList.add("hidden"); // Hide preview if not an image
                alert("Please upload a valid image file.");
                photoinput.style.display = "flex"; // Hide the upload prompt

            }
        });

    </script>


<script>
document.getElementById("payment-form").addEventListener("submit", function(e) {
    e.preventDefault(); // stop normal form

     const submitBtn = this.querySelector("button[type='submit']");
    submitBtn.disabled = true;

    const refno = document.getElementById("refno").value.trim();
    const receiptFile = document.getElementById("receipt-file").files[0];
    const cart = JSON.parse(localStorage.getItem("cart")) || [];

    if (!refno || !receiptFile || cart.length === 0) {
        alert("Please enter Ref No., upload receipt, and have items in cart.");
         submitBtn.disabled = false; // re-enable if validation fails
        submitBtn.textContent = "Submit Payment Receipt";
        return;
    }

    // Build FormData
    const formData = new FormData();
     formData.append("payment_refno", refno);          
    formData.append("receipt-file", receiptFile);     
    formData.append("products", JSON.stringify(cart));

    // Send cart items
    cart.forEach((item, index) => {
        formData.append(`items[${index}][id]`, item.id);
        formData.append(`items[${index}][qty]`, item.qty);
        formData.append(`items[${index}][price]`, item.price.replace(/[₱,]/g, ""));
    });

    // Optionally total
    const total = cart.reduce((sum, i) => sum + (parseFloat(i.price.replace(/[₱,]/g,"")) * i.qty), 0);
    formData.append("total_amount", total);

    // AJAX call
    fetch("submitorder.php", {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        console.log("Server response:", data);
        alert("Order submitted successfully!");

        // clear cart
        localStorage.removeItem("cart");
        window.location.href = "receipt.html?orderid=" + data.order_id;
    })
    .catch(err => {
        console.error("Error submitting order:", err);
        alert("Error submitting order. Please try again.");

        // re-enable button on failure
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit Payment Receipt";
    });
});
</script>




    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const myButton = document.getElementById('paymentMethodBtn');
            setTimeout(() => {
                if (myButton) {
                    myButton.click();
                }
            }, 200);

        });
    </script>


    <script>


        document.addEventListener("DOMContentLoaded", () => {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const container = document.getElementById("checkout-items");
            const totalEl = document.getElementById("checkout-total");
            const paymentTotalEl = document.getElementById("payment-total");

            let total = 0;

            // Clear existing (keep header)
            container.innerHTML = "<h3 class='font-semibold'>Order Items</h3>";

            if (cart.length === 0) {
                container.innerHTML += `
            <p class="text-gray-500 text-sm">Your cart is empty.</p>
        `;
            } else {
                cart.forEach(item => {
                    const price = parseFloat(item.price.replace(/[₱,]/g, ""));
                    const subtotal = price * item.qty;
                    total += subtotal;

                    container.innerHTML += `
                <div class="flex items-center justify-between p-2 border rounded-lg shadow-sm">
                    <div class="flex items-center gap-3">
                        <img src="${item.img}" alt="${item.title}" class="h-16 rounded-md  w-14 aspect-[3/4] object-cover">
                        <div>
                            <p class="font-semibold">${item.title}</p>
                            <p class="text-sm text-gray-600">Quantity: ${item.qty}</p>
                        </div>
                    </div>
                    <span class="font-semibold">₱${subtotal.toFixed(2)}</span>
                </div>
            `;
                });
            }

            totalEl.textContent = "₱" + total.toFixed(2);
            paymentTotalEl.textContent = "₱" + total.toFixed(2);
        });
    </script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];

        // --- ADD THIS LINE ---
        console.log("Cart contents:", cart);
        // ---------------------

        const container = document.getElementById("checkout-items");
        const totalEl = document.getElementById("checkout-total");
        const paymentTotalEl = document.getElementById("payment-total");

        let total = 0;

        // Clear existing (keep header)
        container.innerHTML = "<h3 class='font-semibold'>Order Items</h3>";

        if (cart.length === 0) {
            container.innerHTML += `
                <p class="text-gray-500 text-sm">Your cart is empty.</p>
            `;
        } else {
            cart.forEach(item => {
                const price = parseFloat(item.price.replace(/[₱,]/g, ""));
                const subtotal = price * item.qty;
                total += subtotal;

                container.innerHTML += `
                    <div class="flex items-center justify-between p-2 border rounded-lg shadow-sm">
                        <div class="flex items-center gap-3">
                            <img src="${item.img}" alt="${item.title}" class="h-16 rounded-md w-14 aspect-[3/4] object-cover">
                            <div>
                                <p class="font-semibold">${item.title}</p>
                                <p class="text-sm text-gray-600">Quantity: ${item.qty}</p>
                            </div>
                        </div>
                        <span class="font-semibold">₱${subtotal.toFixed(2)}</span>
                    </div>
                `;
            });
        }

        totalEl.textContent = "₱" + total.toFixed(2);
        paymentTotalEl.textContent = "₱" + total.toFixed(2);
    });
</script>
</body>

</html>